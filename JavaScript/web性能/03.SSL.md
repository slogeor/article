### SSL 传输层安全

TSL 协议的目标是为在它之上运行的应用提供三个基本服务：加密、身份验证、完整性。

**加密**

混淆数据的机制

**身份验证**

验证身份标识有效性的机制

**完整性**

检测消息是否被篡改或伪造的机制

#### TLS 握手

* 新 TLS 连接要完成一次完整的握手，需要两次网络往返。
* 每一个 TLS 连接在 TCP 握手基础上最多还需要两次额外的往返。
* 0 ~ 56ms TCP 的三次握手
* 56ms ~ 112ms 客户端和服务器可以开始加密通信
* 112ms ~ 168ms 验证ok，建立信道并开始发送应用数据

#### SNI

SNI 协议允许客户端在握手之初就指明要连接的主机，Web 服务器可以检查 SNI 主机，选择适当的证书，继续完成握手。

#### TLS 会话恢复

TSL 提供了恢复功能，即可以在多个连接间共享协商后的安全密钥。

**会话标识符**

在内部，服务器会为每个客户端保存一个会话 ID 和协商后的会话参数。假设客户端和服务器都可以在自己的缓存中找到共享的会话 ID 参数，那就可以进行简短握手。从而减少省一次往返时间。

由于服务器必须为每个客户端都创建和维护一段会话缓存，因此需要一套会话 ID 缓存和清楚策略。

**会话记录单**

不用服务器保存每个客户端的会话状态，客户端会将会话记录单保存起来。所有的会话数据只保存在客户端。

会话标识符和会话记录单机制被人称为会话缓存和无状态恢复机制，无状态恢复机制的有点主要是消除了服务器端的缓存负担。

#### 证书撤销

##### CRL

CRL 是一种检查所有证书状态的简单机制。CRL 文件本身可以定期更新发布，这个名单由证书颁发机构签名，允许被缓存一定时间，无法提供实时检查证书状态的机制。

存在问题

* 1.CRL 名单会随着要撤销证书的增多而边长
* 2.没有办法立即更新

##### OCSP

在线证书状态协议提供了一种实时检查证书状态机制，支持验证端直接查询证书数据库中的序列号，从而验证证书链是否有效。

存在的问题

* 1.必须处理实时查询
* 2.确保随时随地可以访问
* 3.协商之前会阻塞 OCSP 请求
* 4.实时 OCSP 请求可能会泄露客户端隐私

#### HSTS

HSTS 通过把责任转移到客户端，让客户端自动把所有链接重写为 HTTPS，消除了从 HTTP 到 HTTPS 的重定向损失。

#### 专业名词

* CRL: 证书撤销名单
* OCSP: 在线证书状态协议
* HSTS: HTTP严格传输安全
* SNI: 服务器名称指示

#### 性能检查清单

* 最大性能提升 TCP 性能
* 把 TSL 库升级到最新版本
* 启用并配置会话缓存和无状态恢复
* 在接近用户的地方完成 TSL 会话，尽量减少往返延迟
* 配置 TSL 记录大小，使其恰好能封装在一个 TCP 段内
* 确保证书链不会超过拥塞窗口的大小
* 从信任链中去掉不必要的证书，减少链条层次
* 禁用服务器的 TLS 压缩功能
* 启用服务器对 SNI 的支持
* 启用服务器的 OCSP 封装功能
* 追加 HTTP严格传输安全首部
